Lyte.Component.register("lyte-search",{_template:'<template tag-name="lyte-search">\n    <lyte-input lt-prop-auto-update="{{ltPropAutoUpdate}}" lt-prop-tab-index="{{ltPropTabIndex}}" lt-prop-id="{{ltPropId}}" lt-prop-wrapper-style="{{ltPropWrapperStyle}}" lt-prop-class="{{ltPropClass}}" lt-prop-autofocus="{{ltPropAutofocus}}" lt-prop-autocomplete="{{ltPropAutocomplete}}" lt-prop-type="{{ltPropType}}" lt-prop-name="{{ltPropName}}" lt-prop-placeholder="{{ltPropPlaceholder}}" lt-prop-width="{{ltPropWidth}}" lt-prop-height="{{ltPropHeight}}" onkeyup="{{action(\'keyup\', event, this)}}" lt-prop-style="{{ltPropStyle}}" lt-prop-value="{{lbind(ltPropValue)}}" onkeypress="{{action(\'keypress\', event, this)}}" lt-prop-appearance="{{ltPropAppearance}}" lt-prop-direction="{{ltPropDirection}}" lt-prop-disabled="{{ltPropDisabled}}" lt-prop-readonly="{{ltPropReadonly}}" on-value-change="{{method(\'valuechange\')}}" on-focus="{{method(\'focus\')}}" on-blur="{{method(\'blurEvent\')}}" lt-prop-input-title="{{ltPropInputTitle}}" lt-prop-pattern="{{ltPropPattern}}" lt-prop-maxlength="{{ltPropMaxlength}}" oninput="{{action(\'input\', event)}}" lt-prop-close-icon="{{ltPropCloseIcon}}" is-search="true" lt-prop-update-delay="{{ltPropUpdateDelay}}"></lyte-input>\n</template>',_dynamicNodes:[{type:"attr",position:[1]},{type:"componentDynamic",position:[1]}],_observedAttributes:["ltPropAutocomplete","ltPropPlaceholder","ltPropAutofocus","ltPropDisabled","ltPropStyle","ltPropMaxlength","ltPropReadonly","ltPropId","ltPropClass","ltPropType","ltPropName","ltPropWidth","ltPropHeight","ltPropValue","ltPropAppearance","ltPropDirection","ltPropQuerySelector","ltPropMinLength","ltPropMethod","ltPropWrapperStyle","ltPropTabIndex","ltPropAjaxRequest","ltPropAutoUpdate","ltPropPattern","ltPropInputTitle","ltPropCloseIcon","ltPropUpdateDelay","ltPropSearchDelay","ltPropComponent","timeout"],init:function(){this.getMethods("beforeRender")&&this.executeMethod("beforeRender",this.$node)},didConnect:function(){this.$node.setValue=function(t,e){this.$node.ltProp("value",t),this.pressFunc(t||"",e||{})}.bind(this),this.getMethods("afterRender")&&this.executeMethod("afterRender",this.$node),["focus","blur","click","select"].forEach(function(t){this.$node[t]=function(e){this.$node.querySelector("lyte-input")[t](e)}.bind(this)}.bind(this)),$L.fastdom.measure(function(){_lyteUiUtils.getRTL()&&$L.fastdom.mutate(function(){this.$node.classList.add("lyteRTL")}.bind(this))}.bind(this));var t=this.data.ltPropComponent,e=this.data.ltPropQuerySelector;"accordion"==t?e.related="lyte-accordion-item":"tree"==t&&(e.related=".lyteTreeBodyDiv lyte-yield:not(.noChildClass) lyte-tree-icon")},didDestroy:function(){clearTimeout(this._comptime)},data:function(){return{ltPropAutocomplete:Lyte.attr("string",{default:"off"}),ltPropPlaceholder:Lyte.attr("string",{default:""}),ltPropAutofocus:Lyte.attr("boolean",{default:!1}),ltPropDisabled:Lyte.attr("boolean",{default:!1}),ltPropStyle:Lyte.attr("string",{default:""}),ltPropMaxlength:Lyte.attr("number",{default:25}),ltPropReadonly:Lyte.attr("boolean",{default:!1}),ltPropId:Lyte.attr("string",{default:"inputId"}),ltPropClass:Lyte.attr("string",{default:""}),ltPropType:Lyte.attr("string",{default:"search"}),ltPropName:Lyte.attr("string",{default:""}),ltPropWidth:Lyte.attr("string",{default:"100%"}),ltPropHeight:Lyte.attr("string",{default:""}),ltPropValue:Lyte.attr("string",{default:""}),ltPropAppearance:Lyte.attr("string",{default:"flat"}),ltPropDirection:Lyte.attr("string",{default:"vertical"}),ltPropQuerySelector:Lyte.attr("object",{default:{}}),ltPropMinLength:Lyte.attr("number",{default:1}),ltPropMethod:Lyte.attr("string",{default:"contains"}),ltPropWrapperStyle:Lyte.attr("string",{default:""}),ltPropTabIndex:Lyte.attr("string",{default:"0"}),ltPropAjaxRequest:Lyte.attr("object",{default:{}}),ltPropAutoUpdate:Lyte.attr("boolean",{default:!0}),ltPropPattern:Lyte.attr("string",{default:".+"}),ltPropInputTitle:Lyte.attr("string",{default:""}),ltPropCloseIcon:Lyte.attr("boolean",{default:!1}),ltPropUpdateDelay:Lyte.attr("number",{default:250}),ltPropSearchDelay:Lyte.attr("number",{default:100}),ltPropComponent:Lyte.attr("string",{default:void 0}),timeout:Lyte.attr("number",{default:void 0})}},methods:{blurEvent:function(t){this.getMethods("onBlur")&&this.executeMethod("onBlur",t,this.$node)},focus:function(t){this.getMethods("onFocus")&&this.executeMethod("onFocus",t,this.$node)},valuechange:function(t){this.getMethods("onValueChange")&&this.executeMethod("onValueChange",t,this.$node)}},arrayFrom:function(t){for(var e=[],o=0;o<t.length;o++)e.push(t[o]);return e.slice()},searchList:function(t){var e=[],o=[];query=this.getData("ltPropQuerySelector"),"string"==typeof query&&(query=JSON.parse(query));for(var r=0;r<t.childElementCount;r++){for(;t.children[r].childElementCount;){returnedVal=this.searchList.call(this,t.children[r]),e=e.concat(returnedVal[0]),o=o.concat(returnedVal[1]);break}if(!t.children[r].childElementCount)if(e.push(t.children[r].textContent),query.target){var l="string"==typeof query.scope?document.body.querySelector(query.scope.trim()):query.scope;for(targetList=l.querySelectorAll(query.target),node=t.children[r];node!=l;){for(var a=!1,i=0;i<targetList.length;i++)if(node==targetList[i]){o.push(node),a=!0;break}if(a)break;node=node.parentElement}}else o.push(t.children[r])}return[e,o]},actions:{"on-ip-clear":function(t){this.$node.setValue("",{type:"clear"})},keypress:function(t){var e=t.keyCode;e>=37&&e<=40||13==e||t.stopPropagation()},keyup:function(t,e){var o=t.which||t.keyCode;if(!([37,13,38,39,40,27].indexOf(o)>-1)){clearTimeout(this.data.timeout),clearTimeout(this._iptime);var r=this.$node.querySelector("input,textarea").value;if(r.length>=this.getData("ltPropMinLength")||8==t.keyCode||91==t.keyCode||17==t.keyCode){var l=this.data.ltPropSearchDelay;void 0!=l?this.timeout=setTimeout(this.pressFunc.bind(this),l,r,t):this.pressFunc.call(this,r,t)}}},input:function(t){clearTimeout(this._iptime),this._iptime=setTimeout(this.pressFunc.bind(this),250,t.target.value,t)}},filteringArray:function(t,e,o,r,l,a){var i=this.getData("ltPropMethod"),n=[],s=[];if(o.length)for(var c=0;c<t.length;c++){var d=!1,p=t[c].trim().toLowerCase();switch(i){case"contains":d=p.indexOf(o.toLowerCase())>=0;break;case"startsWith":d=0==p.indexOf(o.toLowerCase());break;case"endsWith":var h=p.lastIndexOf(o.toLowerCase());-1!=h&&(d=h+o.length==t[c].trim().length)}d?n.push(r[c]):s.push(r[c])}else n=r;this.getMethods("onSearch")&&0==this.executeMethod("onSearch",n,this.$node,l&&"clear"==l.type?{}:l,o,s)||(void 0==this.data.ltPropSearchDelay?this.hideProcess(t,e,i,o,a,l):$L.fastdom.mutate(this.hideProcess.bind(this,t,e,i,o,a,l)))},hideProcess:function(t,e,o,r,l,a){for(var i=this.data.ltPropQuerySelector,n=0;n<t.length;n++){var s=!1,c=t[n].trim().toLowerCase();switch(o){case"contains":s=c.indexOf(r.toLowerCase())>=0;break;case"startsWith":s=0==c.indexOf(r.toLowerCase());break;case"endsWith":var d=c.lastIndexOf(r.toLowerCase());-1!=d&&(s=d+r.length==t[n].trim().length)}this.additionalHand(e[n],s,r,a)}for(n=0;n<l.length;n++){if("accordion"==this.data.ltPropComponent&&void 0==l[n]._state){if(!l[n].querySelector("lyte-accordion-body")){r?l[n].classList.add("lyteSearchHidden"):l[n].classList.remove("lyteSearchHidden");continue}l[n]._state=l[n].classList.contains("lyteAccordionActive")}else if("tree"==this.data.ltPropComponent){void 0==l[n]._state&&(l[n]._state=l[n].classList.contains("lyteIconOpened"));continue}l[n].querySelectorAll(i.target||i.search).length==l[n].querySelectorAll(".lyteSearchHidden").length?l[n].classList.add("lyteSearchHidden"):l[n].classList.remove("lyteSearchHidden")}r||"tree"!=this.data.ltPropComponent||this.hiderecurse($L(i.scope+" lyte-yield:not(.noChildClass) lyte-tree-icon"),a&&"clear"==a.type)},removeClse:function(t,e,o){var r=$L(t).closest(e,o);r.length&&(r.removeClass("lyteSearchHidden"),this.removeClse(t,e,o))},hiderecurse:function(t,e){for(var o=t.length-1;o>=0;o--){var r=t.eq(o);e&&void 0!=r[0]._state?(r[0]._state&&!r.hasClass("lyteIconOpened")||!r[0]._state&&r.hasClass("lyteIconOpened"))&&setTimeout(r.click.bind(r),20):r.hasClass("lyteIconOpened")&&setTimeout(r.click.bind(r),20),delete r[0]._state}},additionalHand:function(t,e,o,r){var l=this.data.ltPropComponent,a=this.data.ltPropQuerySelector,i=a.scope.constructor==String?document.querySelector(a.scope):a.scope;if(e){if(l)if("accordion"==l){var n=$L(t).closest("lyte-accordion-item"),s=$L("lyte-accordion-body",n);clearTimeout(n[0]._comptime),n[0]._comptime=setTimeout(function(){o.length&&!n.hasClass("lyteAccordionActive")&&n.click(),o||(r&&"clear"==r.type?(n[0]._state&&!n.hasClass("lyteAccordionActive")||0==n[0]._state&&n.hasClass("lyteAccordionActive"))&&(n[0]._state||(n.click(),delete n[0]._state)):n.hasClass("lyteAccordionActive")&&(n.click(),delete n[0]._state))}.bind(this),20),!o&&s.addClass("lyteSearchHidden"),s.length&&clearTimeout(s[0]._comptime),s.length&&(s[0]._comptime=setTimeout(function(){s.removeClass("lyteSearchHidden")},20))}else if("dropdown"==l){var c=$L(t).closest("lyte-drop-box")[0];c&&c.classList.contains("lyteDropdownHidden")&&c.origindd.toggle()}else"tree"==l&&(this.removeClse(t,(a.target||a.search)+".lyteSearchHidden",a.scope),o.length&&!$L("lyte-tree",t).eq(0).hasClass("lyteTreeOpened")&&(clearTimeout(t._comptime),t._comptime=setTimeout(function(){var e=$L(t.children[0]).attr("data-value");document.body.contains(i)&&e.length&&i.ltProp("stateAttr",e)},20)));t.classList.remove("lyteSearchHidden")}else{if(t.classList.contains("lyteSearchHidden"))return;t.classList.add("lyteSearchHidden")}l&&"accordion"==l&&(setTimeout(function(){$L(t).closest("lyte-accordion-body").css("height","auto")}.bind(this),0),clearTimeout(this._acctime),this._acctime=setTimeout(i.component.getAllHeights.bind(i.component),0))},pressFunc:function(t,e){if(!this.getMethods("onBeforeSearch")||0!=this.executeMethod("onBeforeSearch",e,this)){var o,r=[],l=[],a=[],i=this.data.ltPropQuerySelector,n="string"==typeof i.scope?document.body.querySelector(i.scope.trim()):i.scope;if(i.search&&(l=n.querySelectorAll(i.search.trim())),a=i.target?n.querySelectorAll(i.target.trim()):l,i.search)for(var s=0;s<l.length;s++)r[s]=l[s].textContent;else returnedVal=this.searchList.call(this,n),r=returnedVal[0],l=(a=returnedVal[1]).slice();o=i.related&&(i.search||i.target)?o=n.querySelectorAll(i.related):[],this.filteringArray.call(this,r,a,t,l,e,o),this._prevVal=t}}});